<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button id="btn">发送请求</button>
    <script>
      var btn = document.getElementById('btn')
      function fn(data) {
        console.log(data)
      }
      function jsonp(options) {
        var script = document.createElement('script')
        var params = ''
        for (var attr in options.data) {
          params += '&' + attr + '=' + options.data[attr]
        }
        var fnName = 'jsonp' + Math.random().toString().replace('.', '')
        // 把success 变成全局函数
        window[fnName] = options.success
        script.src = options.url + '?callback=' + fnName + params

        document.body.appendChild(script)

        script.onload = function () {
          document.body.removeChild(script)
        }
      }
      btn.onclick = function () {
        jsonp({
          url: 'http://localhost:3001/test',
          data: {
            name: 'wenhe',
            sex: 'man'
          },
          success: function (result) {
            console.log(123)
            console.log(result)
          }
        })
      }
    </script>
  </body>
</html>
