<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 单一归类
      var users = [
        { id: '1', name: 'zs', sex: '1' },
        { id: '2', name: 'ls', sex: '1' },
        { id: '3', name: 'ww', sex: '2' },
        { id: '4', name: 'zl', sex: '2' }
      ]

      var sex = [
        { id: '1', sex: '男' },
        { id: '2', sex: '女' }
      ]

      // var cache = {}
      // sex.forEach(function (sexElem) {
      //   var _id = sexElem.id
      //   cache[_id] = []
      //   users.forEach(function (userElem) {
      //     var _sex = userElem.sex

      //     if (_sex === _id) {
      //       cache[_id].push(userElem)
      //     }
      //   })
      // })

      // console.log(cache)

      // 复合归类

      var hobby = [
        { id: '1', name: '足球' },
        { id: '2', name: '篮球' },
        { id: '3', name: '排球' },
        { id: '4', name: '乒乓球' }
      ]

      var person = [
        { name: 'zs', hobby: '1,2' },
        { name: 'ls', hobby: '1,3' },
        { name: 'ww', hobby: '2,4' },
        { name: 'zl', hobby: '1,4' },
        { name: 'xb', hobby: '3' }
      ]

      // 复合归类
      // var cache = {}
      // hobby.forEach(function (hobbyElem) {
      //   var _id = hobbyElem.id
      //   cache[_id] = []

      //   person.forEach(function (personElem) {
      //     var _hobbyArr = personElem.hobby.split(',')

      //     _hobbyArr.forEach(function (elem) {
      //       if (elem === _id) {
      //         cache[_id].push(personElem)
      //       }
      //     })
      //   })
      // })

      // console.log(cache)

      // 封装数据归类函数

      //sort:据以归类的表格， data：要归类的表格数据
      function sortDatas(sort, data) {
        var cache = {}

        //foreign_key: 外键, sortType: 归类类型
        return function (foreign_key, sortType) {
          if (sortType !== 'single' && sortType !== 'multi') {
            console.log(new Error('Invalid sort type.[only "single" and "multi" are valid values]'))
            return
          }

          sort.forEach(function (sortElem) {
            var _id = sortElem.id
            cache[_id] = []

            data.forEach(function (dataElem) {
              var foreign_val = dataElem[foreign_key]
              switch (sortType) {
                case 'single':
                  if (foreign_val === _id) {
                    cache[_id].push(dataElem)
                  }
                  break
                case 'multi':
                  var _arr = foreign_val.split(',')
                  _arr.forEach(function (_arrElem) {
                    if (_arrElem === _id) {
                      cache[_id].push(dataElem)
                    }
                  })
                  break
                default:
                  break
              }
            })
          })
          return cache
        }
      }

      var singleSort = sortDatas(sex, users)
      console.log(singleSort('sex', 'single'))

      var multiSort = sortDatas(hobby, person)
      console.log(multiSort('hobby', 'multi'))
    </script>
  </body>
</html>
